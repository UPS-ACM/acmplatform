<!DOCTYPE html>
<html>
  <head>
  <title>LogJam</title>
  <link rel="stylesheet" type="text/css" href="map.css">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBInghLZWYDJBA789Ga2_2qTmM5DLb1nno&libraries=places"></script>
  <script src="data.js"></script>
    <script>

      var sortedData = [];

      var map
      var myCenter
      if (data.length==0){
        myCenter = new google.maps.LatLng(47.262190,-122.481500);
      }else {
        sortedData  = data.sort(function(a,b){
          var club1 = a[2].toUpperCase();
          var club2 = b[2].toUpperCase();
          if (club1<club2) return -1;
          if (club1>club2) return 1;
          return 0;
        });
        var avgLat = 0.0
        var avgLng = 0.0
        function findCenter(){
          for (var i = 0; i<sortedData.length; i++){
            avgLat+=sortedData[i][0].lat,
            avgLng+=sortedData[i][0].lng
          }
        }
        findCenter()
        avgLat/=sortedData.length
        avgLng/=sortedData.length
        myCenter = new google.maps.LatLng(avgLat,avgLng);
      }

      var markers = [];
      
      function initialize(){
        var mapProp = {
          center: myCenter,
          zoom:19,
          disableDefaultUI:false,
          mapTypeId: google.maps.MapTypeId.SATELLITE//ROADMAP
        };

        map = new google.maps.Map(document.getElementById("map"),mapProp);

        var marker, i;
        var infoBox = new google.maps.InfoWindow();

        map.setTilt(0);
        google.maps.event.addListener(map, 'click', function(){
          infoBox.close();
        })

        // potential icons i guess
        var image = //'http://i.turner.ncaa.com/dr/ncaa/ncaa7/release/sites/default/files/images/logos/schools/p/puget-sound.40.png';
        //'http://soundideas.pugetsound.edu/assets/institution_icons/2068434.png'; //hatchet
        'http://tartarus.rpgclassics.com/ss2/item/0026.gif';
        //'https://s-media-cache-ak0.pinimg.com/avatars/univpugetsound-61_30.jpg';
        //'http://www.htmlcsscolor.com/preview/16x16/660000.png';
        //'http://icons.veryicon.com/ico/System/Led/clipboard%20text.ico';//'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png';
    
        //*
        var getCenterTag = document.getElementById('clublinks');
        if (sortedData.length==0){
          var noClubs = document.createElement('h3');
          noClubs.appendChild(document.createTextNode('No clubs have signed up yet!'));
          getCenterTag.appendChild(noClubs);
        }else {
          for (i = 0; i<sortedData.length; i++){
            
            marker = new google.maps.Marker({
              map: map,
              position: sortedData[i][0],//positions[i],
              icon: image
            });
            google.maps.event.addListener(marker, 'click', (function(marker, i) {
              return function(){
                infoBox.setContent(sortedData[i][1]);
                infoBox.open(map, marker);  
              }
            })(marker, i));
            //attachInfo(marker, i);
            markers.push(marker);

            var createA = document.createElement('a');
            var createAText = document.createTextNode(sortedData[i][2]);
            createA.setAttribute("href", "#");
            createA.setAttribute("onClick", "myClick("+i+");");
            createA.appendChild(createAText);
            getCenterTag.appendChild(createA);
            getCenterTag.appendChild(document.createElement('br'));
            getCenterTag.appendChild(document.createElement('br'));
          }
        }

        function attachInfo(marker, info){
          marker.addListener('click', function(){
            infoBox.setContent(sortedData[info][1]);//info);
            //infoBox.open(marker.get('map'), marker);
            infoBox.open(map, marker);
          })
        }
      } // end of intitialize()
      // actually load the map
      google.maps.event.addDomListener(window, 'load', initialize);
      //*
      function myClick(id){
        google.maps.event.trigger(markers[id], 'click');
      }//*/
    </script>
  </head>
  <body>
    <center>
    <h2>Find your favorite clubs!</h2>
    <div id ="map" style ="width:100g%;height:400px;"></div>
    <div id="clublinks"></div>
    </center>
  </body>
</html>

